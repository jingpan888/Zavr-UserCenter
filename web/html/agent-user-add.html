<!DOCTYPE HTML>
<html xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8"><style type="text/css">[v-cloak] {
            display: none;
        }</style>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<style>
	.col-sm-3{
		width: 18%;
	}
</style>
<![endif]-->
<title>添加代理员工</title>
<meta name="keywords">
	<meta name="description">
</head>
<body>
<article class="page-container" id="app" v-cloak>
	<form method="post" class="form form-horizontal" id="form-member-add">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>员工账号：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="Identifier" name="Identifier" v-model="Identifier">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>员工姓名：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="name" name="name" v-model="name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>员工姓别：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<select id="gender" class="select" v-model="gender" name="gender">
					<option value="" disabled>请选择</option>
					<option value="1">男</option>
					<option value="2">女</option>
					<option value="3">保密</option>
				</select>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所属代理名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="agentName" name="agentName" v-model="agentName">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>员工类别：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<select id="type" class="select" v-model="type" name="type">
					<option value="" disabled>请选择</option>
					<option value="2">普通员工</option>
					<option value="1">管理员</option>
				</select>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所属部门：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<select id="department" class="select" v-model="department" name="department">
					<option value="" disabled>请选择</option>
					<option value="2">研发部</option>
					<option value="1">管理员</option>
					<option value="3">产品部</option>
					<option value="4">市场部</option>
					<option value="5">创意部</option>
				</select>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>员工电话：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="iphone" name="iphone" v-model="iphone">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>员工邮箱：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="email" name="email" v-model="email">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>设置密码：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="password" name="password" v-model="password">
			</div>
		</div>
		<div class="row cl" v-if="id != ''">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>状态：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<select id="status" class="select" v-model="status" name="status">
					<option value="1">启用</option>
					<option value="2">禁用</option>
				</select>
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
				<button class="btn btn-primary radius" type="submit">提交</button>
			</div>
		</div>
	</form>
</article>

<!--_footer 作为公共模版分离出去--> 
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="lib/layui/layui.all.js"></script>
<script type="text/javascript" src="lib/vue.min.js"></script>
<script type="text/javascript" src="lib/request.js"></script>
<script type="text/javascript">
    var vue = new Vue({
        el: '#app',
        data: {
        	date:[],
        	id:'',
        	agentName:'',
            name:'',
            gender:'',
            type:'',
            status:'',
            Identifier:'',
            list1:[],
            department:'',
			password:'',
            email:'',
            iphone:''
        }
    });

       $(document).ready(function(){
           $("#tijiao").mouseover(function(){layer.msg('请确保信息已填写且格式无误');
               layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element'], function() {
                   var layer = layui.layer;
                   //向世界问个好
      
               });
           });
           $("tijiao").mouseout(function(){
      
           });
       });

    $(function(){
        vue.id = UrlParam.paramValues("ID");
        vue.list1 = parent.vue.userInfo.List1;
        if(vue.id!=undefined){
            GetUserInfo();
        }
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });

        $("#form-member-add").validate({
            rules:{
                name:{
                    required:true,
                    rangelength:[2,20]
                },
                Identifier:{
                    required:true,
                    rangelength:[6,20]
                },
                agentName:{
                    required:true,
                    rangelength:[5,20]
                },
                gender:{
                    required:true
                },
                type:{
                    required:true
                },
                status:{
                    required:true
                },
                email:{
                    email:true,
                    required:true,
                    rangelength:[4,30]
				},
                password:{
                    rangelength:[6,30]
				},
                iPhone:{
                    required:true,
                    digits:true,
                    rangelength:[11,11]
				}
            },
            onkeyup:false,
            focusCleanup:true,
            success:"valid",
            submitHandler:function(){
	            if(vue.id!=undefined){
	            	updateUser();//修改
	        	}else{
	            	createUser();//新增
	        	}
	            var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            }
        });
    });
    function GetUserInfo() {
        var param = "{\"UID\":"+vue.id+"}";
        // console.log(param);
           $.ajax({
               type: "post",
               url: GetAgentUser,
               data: {parameter:param},
               dataType: "json",
               success: function(data){
                   console.log(JSON.stringify(data));
                   vue.date = data.Data;
                   vue.name=data.Data.name;
                   vue.agentName=data.Data.agent.name;
                   vue.type=data.Data.type;
                   vue.status=data.Data.status;
                   vue.gender=data.Data.gender;
                   vue.Identifier=data.Data.userAuth.identifier;
                   vue.department=data.Data.department;
                   vue.email=data.Data.email;
                   vue.iphone=data.Data.iphone;
                   $("#type").val(vue.type);
                   $("#type").trigger("change");
                   $("#status").val(vue.status);
                   $("#status").trigger("change");
                   $("#gender").val(vue.gender);
                   $("#gender").trigger("change");
               },error:function(err){
                   layer.msg('程序异常，错误代码'+JSON.stringify(err));
               }
           });
    }


	function createUser() {
        if(vue.name==''|| vue.name == null || vue.name == undefined){
            layer.msg('员工姓名为空');
            return;
        }
        if(vue.agentName==''|| vue.agentName == null || vue.agentName == undefined){
            layer.msg('代理名称为空');
            return;
        }
        if(vue.Identifier==''|| vue.Identifier == null || vue.Identifier == undefined){
            layer.msg('员工账号为空');
            return;
        }
        var param = "{\"Name\":\""+vue.name+"\",\"Iphone\":\""+vue.iphone+"\",\"Email\":\""+vue.email+"\",\"Password\":\""+vue.password+"\",\"Department\":\""+vue.department+"\",\"agentName\":\""+vue.agentName+"\",\"Gender\":\""+vue.gender+"\",\"Type\":\""+vue.type+"\",\"Status\":\""+vue.status+"\",\"Identifier\":\""+vue.Identifier+"\"}";
        console.log(param);
        $.ajax({
            type: "post",
            url: CreateAgentUser,
            data: {parameter:param},
            dataType: "json",
            success: function(data){
                console.log(JSON.stringify(data));
                parent.layer.msg(data.Message,{icon:6});
            },error:function(err){
                parent.layer.msg('程序异常，错误代码'+JSON.stringify(err));
            }
        });
    }

    //更新信息
    function updateUser() {
        var param = "{\"UID\":"+vue.id+",\"Name\":\""+vue.name+"\",\"Iphone\":\""+vue.iphone+"\",\"Email\":\""+vue.email+"\",\"Password\":\""+vue.password+"\",\"Department\":\""+vue.department+"\",\"agentName\":\""+vue.agentName+"\",\"Gender\":\""+vue.gender+"\",\"Type\":\""+vue.type+"\",\"Status\":\""+vue.status+"\",\"Identifier\":\""+vue.Identifier+"\"}";
        console.log(param);
        $.ajax({
            type: "post",
            url: SetAgentUser,
            data: {parameter:param},
            dataType: "json",
            success: function(data){
				if(data.Success){
                	parent.layer.msg(data.Message, {icon:6});
            	}else{
                	parent.layer.msg(data.Message, {icon: 5});
            	}
            },error:function(err){
                layer.msg('程序异常，错误代码'+JSON.stringify(err));
            }
        });
    }
</script> 
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>